---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.1'
      jupytext_version: 1.1.5
  kernelspec:
    display_name: Python 2
    language: python
    name: python2
---

```{python}
#create new coordinate system for grasp tor file
import pandas as pd
import os
hornfile = 'allhorns.txt'
data = pd.read_csv(hornfile, sep=" ", header=None)
data.columns = ["horn", "row", "col", "x", "y", "xgrf", "ygrf"]

print data.loc[121,'xgrf']
#print data[120,"xgrf"]

hornstring = "Horn"+str(data.loc[119,'horn'])+"coor_sys"+"  "+"coor_sys"+os.linesep+ \
    "("+os.linesep+ \
    "  origin           : struct(x: "+str(data.loc[119,'xgrf'])+" m, y: "+str(data.loc[119,'ygrf'])+" m, z: 0.0 m),"+os.linesep+ \
    "  y_axis           : struct(x: 0.0, y: -1.0, z: 0.0)"+os.linesep+ \
    ")"

print(hornstring)
```

```{python}
#create output file and append string line by line
f= open("toroutput.txt","w+")

for idx, row in data.iterrows():
    #print idx, row['horn']
    hornstring = "Horn"+str(int(row['horn']))+"coor_sys"+"  "+"coor_sys"+os.linesep+ \
    "("+os.linesep+ \
    "  origin           : struct(x: "+str(row['xgrf'])+" m, y: "+str(row['ygrf'])+" m, z: 0.0 m),"+os.linesep+ \
    "  y_axis           : struct(x: 0.0, y: -1.0, z: 0.0)"+os.linesep+ \
    ")"+os.linesep+os.linesep
    #print hornstring
    f.write(hornstring)
f.close()

```

```{python}
#here we begin crating the tci text output
sourcename = "Horn_Clover12b_Tab_sourceXPol"
m1cur = "Currents_on_TD_M1_3Dmeas_5mm_deformedto1K_SFC"
m2cur = "Currents_on_TD_M2_3Dmeas_5mm_deformedto1K_SFC"
fpgridname = "ONAFP_xy_60_60_240"
m2name = "TD_M2_3Dmeas_5mm_deformedto1k"
tcistring = "#Change the horn to Feedhorn"+str(data.loc[0,'horn'])+os.linesep+ \
    "COMMAND OBJECT "+sourcename+" set (corr_sys:ref(Horn"+str(data.loc[0,'horn'])+"coor_sys))"+os.linesep+ \
    "#Change the ouput file name, Change the currents filenames"+os.linesep+ \
    "COMMAND OBJECT "+m1cur+" set (  file_name:  "+m1cur+str(data.loc[0,'horn'])+".cur)"+os.linesep+ \
    "COMMAND OBJECT "+m2cur+" set (  file_name:  "+m2cur+str(data.loc[0,'horn'])+".cur)"+os.linesep+ \
    "COMMAND OBJECT "+fpgridname+" set (  file_name:  "+fpgridname+str(data.loc[0,'horn'])+".cur)"+os.linesep+ \
    "#  Calculates PO-currents on the FIM1 generated by the feed"+os.linesep+ \
    "COMMAND OBJECT "+m1cur+" get_currents (&"+os.linesep+ \
    "source:sequence(ref("+sourcename+")),field_accuracy:-60.0,&"+os.linesep+ \
    "auto_convergence_of_po:on,convergence_on_scatterer:&"+os.linesep+ \
    "sequence(ref("+m2name+")))"+os.linesep+ \
    "# Calculates PO-currents on the FIM2 generated by the currents on FIM1"+os.linesep+ \
    "COMMAND OBJECT "+m2cur+" get_currents (&"+os.linesep+ \
    "source:sequence(ref("+m1cur+")),field_accuracy:-60.0,&"+os.linesep+ \
    "auto_convergence_of_po:on,convergence_on_output_grid:&"+os.linesep+ \
    "sequence(ref("+fpgridname+")))"+os.linesep+ \
    "# Calculates the field on the ONAFP"+os.linesep+ \
    "COMMAND OBJECT "+fpgridname+" get_field (source:&"+os.linesep+ \
    "sequence(ref("+m2cur+")))"

print tcistring
```

```{python}
#here we loop and write commands for every horn
f= open("tcioutput.txt","w+")
sourcename = "Horn_Clover12b_Tab_sourceXPol"
m1cur = "Currents_on_Mirror1"
m2cur = "Currents_on_Mirror2"
fpgridname = "ONAFP_xy_60mm_60mm_241"
m2name = "Mirror2"

for idx, row in data.iterrows():
    tcistring = "#Change the horn to Feedhorn"+str(int(row['horn']))+os.linesep+ \
    "COMMAND OBJECT "+sourcename+" set (coor_sys:ref(Horn"+str(int(row['horn']))+"coor_sys))"+os.linesep+ \
    "#Change the ouput file name, Change the currents filenames"+os.linesep+ \
    "COMMAND OBJECT "+m1cur+" set (  file_name:  "+m1cur+"_Horn"+str(int(row['horn']))+".cur)"+os.linesep+ \
    "COMMAND OBJECT "+m2cur+" set (  file_name:  "+m2cur+"_Horn"+str(int(row['horn']))+".cur)"+os.linesep+ \
    "COMMAND OBJECT "+fpgridname+" set (  file_name:  "+fpgridname+"_horn"+str(int(row['horn']))+".grd)"+os.linesep+ \
    "#  Calculates PO-currents on the FIM1 generated by the feed"+os.linesep+ \
    "COMMAND OBJECT "+m1cur+" get_currents (&"+os.linesep+ \
    "source:sequence(ref("+sourcename+")),field_accuracy:-60.0,&"+os.linesep+ \
    "auto_convergence_of_po:on,convergence_on_scatterer:&"+os.linesep+ \
    "sequence(ref("+m2name+")))"+os.linesep+ \
    "# Calculates PO-currents on the FIM2 generated by the currents on FIM1"+os.linesep+ \
    "COMMAND OBJECT "+m2cur+" get_currents (&"+os.linesep+ \
    "source:sequence(ref("+m1cur+")),field_accuracy:-60.0,&"+os.linesep+ \
    "auto_convergence_of_po:on,convergence_on_output_grid:&"+os.linesep+ \
    "sequence(ref("+fpgridname+")))"+os.linesep+ \
    "# Calculates the field on the ONAFP"+os.linesep+ \
    "COMMAND OBJECT "+fpgridname+" get_field (source:&"+os.linesep+ \
    "sequence(ref("+m2cur+")))"+os.linesep+os.linesep
    f.write(tcistring)
    print tcistring
f.close()
```

```{python}
#updated version of TOR output
#create output file and append string line by line
#with dz = 2.5 mm
f= open("toroutput.txt","w+")

for idx, row in data.iterrows():
    #print idx, row['horn']
    hornstring = "Horn"+str(int(row['horn']))+"coor_sys"+"  "+"coor_sys"+os.linesep+ \
    "("+os.linesep+ \
    "  origin           : struct(x: "+str(row['xgrf'])+" m, y: "+str(row['ygrf'])+" m, z: 2.5 mm),"+os.linesep+ \
    "  x_axis           : struct(x: -1.0, y: 0.0, z: 0.0)"+os.linesep+ \
    ")"+os.linesep+os.linesep
    #print hornstring
    f.write(hornstring)
    print hornstring
f.close()
```

```{python}
#new TCI output file
#here we loop and write commands for every horn
f= open("tcioutput.txt","w+")
sourcename = "gaussian_beam"
m1cur = "M1_po_single_face_scatterer"
m2cur = "M2_po_single_face_scatterer"
fpgridname = "FP_planar_grid"
m2name = "M2_reflector"

for idx, row in data.iterrows():
    tcistring = "#Change the horn to Feedhorn"+str(int(row['horn']))+os.linesep+ \
    "COMMAND OBJECT "+sourcename+" set (coor_sys:ref(Horn"+str(int(row['horn']))+"coor_sys))"+os.linesep+ \
    "#Change the ouput file name, Change the currents filenames"+os.linesep+ \
    "COMMAND OBJECT "+m1cur+" set (  file_name:  "+m1cur+"_Horn"+str(int(row['horn']))+".cur)"+os.linesep+ \
    "COMMAND OBJECT "+m2cur+" set (  file_name:  "+m2cur+"_Horn"+str(int(row['horn']))+".cur)"+os.linesep+ \
    "COMMAND OBJECT "+fpgridname+" set (  file_name:  "+fpgridname+"_horn"+str(int(row['horn']))+".grd)"+os.linesep+ \
    "#  Calculates PO-currents on the FIM1 generated by the feed"+os.linesep+ \
    "COMMAND OBJECT "+m1cur+" get_currents (&"+os.linesep+ \
    "source:sequence(ref("+sourcename+")),field_accuracy:-60.0,&"+os.linesep+ \
    "auto_convergence_of_po:on,convergence_on_scatterer:&"+os.linesep+ \
    "sequence(ref("+m2name+")))"+os.linesep+ \
    "# Calculates PO-currents on the FIM2 generated by the currents on FIM1"+os.linesep+ \
    "COMMAND OBJECT "+m2cur+" get_currents (&"+os.linesep+ \
    "source:sequence(ref("+m1cur+")),field_accuracy:-60.0,&"+os.linesep+ \
    "auto_convergence_of_po:on,convergence_on_output_grid:&"+os.linesep+ \
    "sequence(ref("+fpgridname+")))"+os.linesep+ \
    "# Calculates the field on the ONAFP"+os.linesep+ \
    "COMMAND OBJECT "+fpgridname+" get_field (source:&"+os.linesep+ \
    "sequence(ref("+m2cur+")))"+os.linesep+os.linesep
    f.write(tcistring)
    print tcistring
f.close()
```

```{python}

```
